<div id="connection-status">Waiting for connection...</div>

<div class="field-name">id</div>
<div class="field-value"><%= server.id %></div>

<div class="field-name">name</div>
<div class="field-value"><%= server.name %></div>

<input type="checkbox" id="status-led-toggle"> Status LED

<script>
  var url = document.location.href;
  var slash = url.indexOf('/', 'http://zzz'.length);
  url = url.substr(0, slash);

  var serverId = null;
  var socket = io.connect(url);
  socket.on('connect', function() {
    console.log('connect');
    socket.emit('message', {
      command: 'server/connect',
      options: {
        id: '<%= server.id %>'
      }
    });
  });
  socket.on('disconnect', function() {
    console.log('disconnect');
  });
  socket.on('message', function(msg) {
    switch (msg.command) {
    case 'server/connected':
      serverId = msg.options.id;
      $('#connection-status').html('Connected');
      break;
    case 'error':
      console.error('Error:', msg.options.message);
      break;
    default:
      console.log(msg);
      break;
    }
  });

  $('#status-led-toggle').change(function() {
    var state = $('#status-led-toggle').is(':checked');
    socket.emit('message', {
      command: 'server/send',
      options: {
        id: serverId,
        command: 'set status_led=' + (state ? '1' : '0')
      }
    });
  });
</script>